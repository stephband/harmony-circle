/* 
   Built 2023-08-01 21:02 */

import{c as d,e as f,g as j,i as v,j as q,k as G,l as O,m as L,o as T,p as X,q as A,r as Y,u as $,z as C}from"../chunk-OM7BFOSU.js";function P(t,e){var s=e%t;return s<0?s+t:s}var et=d(P);function y(t,e,s){return t+P(e-t,s-t)}var rt=d(y);function k([t,e]){return Float64Array.of(t*Math.cos(e),t*Math.sin(e))}function g([t,e]){return Float64Array.of(t===0?Math.abs(e):e===0?Math.abs(t):Math.sqrt(t*t+e*e),Math.atan2(e,t))}var Q=Array.prototype,w=Object.assign,M="webkitUserSelect"in document.body.style?"webkitUserSelect":"userSelect",b={},S={threshold:4,ignoreTags:{textarea:!0,input:!0,select:!0}},N=-1/0;function R(t){t.timeStamp-N>60||(t.stopPropagation(),t.preventDefault())}function V(t,e,s){return e*e+s*s>=t*t}function U(t,e,s){if(this.stream=t,this.events=[e],this.options=s,this.pointerId=e.pointerId,typeof s.threshold=="function")this.checkThreshold=s.threshold;else{let i=$(s.threshold);this.checkThreshold=(o,c,a)=>V(i,o,c,a)}document.addEventListener("pointermove",this),document.addEventListener("pointerup",this),document.addEventListener("pointercancel",this)}w(U.prototype,{handleEvent:f(v("type"),{pointermove:function(t){if(this.pointerId===t.pointerId){if(this.pointerId in b&&this!==b[this.pointerId]){this.stop();return}if(this.events.push(t),!this.isGesture){let e=this.events[0],s=t.clientX-e.clientX,i=t.clientY-e.clientY,o=(t.timeStamp-e.timeStamp)/1e3;this.checkThreshold(s,i,o)&&this.createGesture()}}},pointerup:function(t){this.pointerId===t.pointerId&&(this.events.push(t),this.stop(),this.isGesture&&(N=t.timeStamp,document.addEventListener("click",R,{capture:!0,once:!0})))},default:function(t){this.pointerId===t.pointerId&&(this.events.push(t),this.stop())}}),createGesture:function(){this.isGesture=!0,this.userSelectState=document.body.style[M],document.body.style[M]="none",b[this.pointerId]=this,this.stream.push(new T(this))},pipe:function(t){for(q(this,t);this.events.length;)O(this[0],Q.shift.apply(this.events));this.events=t},stop:function(){if(document.removeEventListener("pointermove",this),document.removeEventListener("pointerup",this),document.removeEventListener("pointercancel",this),this.isGesture&&(document.body.style[M]=this.userSelectState,delete b[this.pointerId]),this[0]){let t=this[0];G(this,0),L(t)}}});function W(t){var e=t.target.tagName;return e&&(!!S.ignoreTags[e.toLowerCase()]||t.target.draggable)}function F(t,e){this.node=t,this.options=e}w(F.prototype,{pipe:function(t){return this[0]=t,this.node.addEventListener("pointerdown",this),t},handleEvent:function(t){if(t.button===0&&!(this.options.device&&!this.options.device.includes(t.pointerType))&&!W(t)&&!(this.options.select&&!t.target.closest(this.options.select))){var e={type:t.type,target:t.target,currentTarget:t.currentTarget,clientX:t.clientX,clientY:t.clientY,timeStamp:t.timeStamp,pointerId:t.pointerId};new U(this[0],e,this.options)}},stop:function(){return this[0]&&(this.node.removeEventListener("pointerdown",this),L(this[0])),this}});function B(t,e){return t=e&&t?w({},S,t):S,e=e||t,new T(new F(e,t))}function H(t){return t.replaceAll(/(∆|maj)|(-|–|min)|(ø)|(˚|dim)|(\+|aug)|(b|♭)|(#|♯)|(sus)|(alt)|(\d+(?:\/\d+)?)/g,(e,s,i,o,c,a,r,n,l,u,p)=>s?'<span class="maj-symbol symbol">△</span>':i?'<span class="min-symbol symbol">-</span>':o?'<sup class="hdim-symbol symbol">∅</sup>':c?'<span class="dim-symbol symbol">°</span>':a?'<sup class="aug-symbol symbol">＋</sup>':r?'<sup class="flat-symbol symbol">♭</sup>':n?'<sup class="sharp-symbol symbol">♯</sup>':l?'<span class="sus-symbol symbol">sus</span>':u?'<span class="alt-symbol symbol">alt</span>':p?`<sup class="num-symbol symbol">${p}</sup>`:"")}var I={pentatonic:{notes:[0,2,4,7,9],chords:["6/9","","","","-11"],transpose:0},major:{notes:[0,2,4,5,7,9,11],chords:["∆","-7","7sus♭9","∆♯11","7","-♭6","ø"],transpose:0},"melodic-minor":{notes:[0,2,3,5,7,9,11],chords:["-∆","7sus♭9","∆+","7♯11","7♭13","ø","7alt"],transpose:7},"diminished-arp":{notes:[0,3,6,9],chords:["˚","˚","˚","˚"],transpose:1},diminished:{notes:[0,1,3,4,6,7,9,10],chords:["7♭9","˚","7♭9","˚","7♭9","˚","7♭9","˚"],transpose:0},"whole-tone":{notes:[0,2,4,6,8,10],chords:["+7","+7","+7","+7","+7","+7"],transpose:0},"augmented-arp":{notes:[0,4,8],chords:["+","+","+"],transpose:0},"harmonic-major":{notes:[0,2,4,5,7,8,11],chords:["","","","","","",""],transpose:0},"harmonic-minor":{notes:[0,2,4,5,8,9,11],chords:["∆+5","-","7♭9","","7","-♭6",""],transpose:0},"double-harmonic-major":{notes:[0,1,4,5,7,8,11],chords:["","","","","","",""],transpose:0},"double-harmonic-minor":{notes:[0,2,4,5,8,9,10],chords:["","","","","","",""],transpose:0}};var x=7.5,E=Math.PI*2,Z=11/12,m=[0,5,10,3,8,1,6,11,4,9,2,7],_=f((t,e)=>e.type,{pointerdown:(t,e)=>{let{scale:s,circleDiv:i}=t,o=Y(i),c={x:o.x+.5*o.width,y:o.y+.5*o.height};return t.centre=c,t.a0=g([e.clientX-c.x,e.clientY-c.y])[1],t.t0=m.indexOf(s.transpose||0),t},pointermove:(t,e)=>{let{r:s,a0:i,t0:o,centre:c,scale:a,scaleName:r,shadow:n,circleDiv:l,scalePath:u}=t,p=g([e.clientX-c.x,e.clientY-c.y])[1],h=Math.round((p-i)*12/E);return h===t.transpose||(t.transpose=h,a.transpose=m.indexOf(y(0,12,o+h)),n.querySelectorAll(".chord-extension").forEach(J=>J.remove()),D(s,l,u,r,a)),t},default:(t,e)=>{let{scale:s,circleDiv:i}=t}});function z(t,e,s){let i=e+s*E/12;return k([t,i])}function D(t,e,s,i,o){let a=o.notes.map((n,l)=>({note:n,chord:o.chords[l],index:m.indexOf(n)})).sort(C(v("index"))),r=a.map(n=>z(t-1.8,(Z+m.indexOf(o.transpose)/12)*E,m.indexOf(n.note))).join("L");s.setAttribute("d","M"+r+"Z"),a.forEach(n=>{let l=y(0,12,n.note+o.transpose),u=e.querySelector(`[value="${l}"]`),p=H(n.chord),h=j("span",{class:i+" chord-extension",html:p});u.append(h)})}function K(t,e,s){t.querySelectorAll(`[value="${e}"]`).forEach(i=>i.classList.add("on")),s.disabled=!1}var Mt={construct:function(t){let e=t.getElementById("circle"),s=t.getElementById("settings"),i=t.querySelectorAll(".note-button"),o=t.getElementById("scale-path"),c=t.getElementById("clear-scale"),a=t.getElementById("advanced-settings");i.forEach(n=>{let l=z(x,Z*E,m.indexOf(parseInt(n.value,10)));n.style.transform=`translate3d(calc(${l[0]}em - 50%), calc(${l[1]}em - 50%), 0)`});let r=localStorage.getItem("scale")||"major";if(r&&r!=="none"){let n=I[r];D(x,e,o,r,n),o.classList.add(r),K(t,r,c)}A("click",t).each(X({'[name="scale"]':(n,l)=>{let u=I[n.value];if(l.shiftKey||(o.classList.remove(r),t.querySelectorAll(".chord-extension").forEach(p=>p.remove()),t.querySelectorAll(".on").forEach(p=>p.classList.remove("on"))),!u){o.removeAttribute("d"),c.disabled=!0,localStorage.setItem("scale","none");return}r=n.value,D(x,e,o,r,u),o.classList.add(r),K(t,r,c),localStorage.setItem("scale",r)}})),B({select:"path",threshold:1},e).each(n=>n.reduce(_,{r:x,shadow:t,circleDiv:e,scalePath:o,scaleName:r,scale:I[r],transpose:0})),A("change",a).each(n=>n.target.checked?localStorage.setItem("advancedSettings",n.target.checked):localStorage.removeItem("advancedSettings")),a.checked=localStorage.getItem("advancedSettings")},connect:function(t){}};export{Mt as default};
